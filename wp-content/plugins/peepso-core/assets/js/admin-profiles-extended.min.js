!function(p){var i,n=p(".ps-js-fields-container"),e=p(".ps-js-field-new"),o=p('<div class="ps-dropdown__menu" />'),t=window.peepsofieldtypes||{};if(n.length||e.length){i="",_.each(t,function(e,t){i+='<a href="#" data-value="'+t+'">'+e+"</a>"}),o.append(i),o.insertAfter(e),e.off("click").on("click",function(e){var t="click.ps-extended-profile",i=p(document);e.preventDefault(),e.stopPropagation(),i.off(t),o.is(":visible")?o.hide():(o.show(),i.one(t,function(){o.hide()}))}),o.on("click","a",function(e){var t=p(this).data("value");e.preventDefault(),e.stopPropagation(),peepso.postJson("adminextendedprofiles.add_field",{type:t},function(e){o.hide(),e.success&&(n.append(e.data.html),s(),p("html, body").animate({scrollTop:p(document).height()},"fast"))})}),n.on("click",".ps-js-field-delete",function(e){if(e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to delete this field?")){var i=p(this).data("id");peepso.postJson("adminextendedprofiles.delete_field",{id:i},function(e){if(e.success){var t=n.children("[data-id="+i+"]");t.slideUp("fast",function(){t.remove()})}})}}),n.on("click",".ps-js-field-duplicate",function(e){if(e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to duplicate this field?")){var t=p(this).data("id");peepso.postJson("adminextendedprofiles.duplicate_field",{id:t},function(e){e.success&&(n.append(e.data.html),s(),p("html, body").animate({scrollTop:p(document).height()},"fast"))})}}),n.on("click",".ps-js-option-new",function(e){for(var t=p(this).closest(".ps-js-field"),i=t.find(".ps-js-option-template"),o=t.find("[data-prop-name=select_options]"),s=i.html(),n=t.data("id"),a="option_"+n+"_",d=1;;d++)if(o.filter('[data-prop-key="'+a+d+'"]').length<1){a+=d;break}s=(s=s.replace(/___val___/g,"")).replace(/___key___/g,a),i.before(s),t.find('input[data-prop-key="'+a+'"]').focus(),l(n)}),n.on("click",".ps-js-option-delete",function(e){var t,i;e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to delete this option?")&&(i=(t=p(this)).closest(".ps-js-field").data("id"),t.closest(".ps-js-fieldconf").remove(),l(i))}),n.on("click",".ps-js-reset-privacy",function(e){var t,i,o,s;e.preventDefault(),e.stopPropagation(),(t=p(this)).data("progress")||(t.data("progress",1).css({opacity:.5}),i=t.closest(".ps-js-fieldconf"),o=i.find("select"),s=i.find(".ps-js-progress"),o.attr("readonly","readonly"),s.find("i").stop().hide(),s.find("img").show(),peepso.postJson("adminExtendedProfiles.reset_privacy",{id:o.data("parent-id")},function(e){s.find("img").hide(),s.find("i").show().delay(800).fadeOut(),o.removeAttr("readonly"),t.removeData("progress").css({opacity:""})}))}),s();var a={}}function s(){n.find(".ps-js-options").sortable({handle:".ps-js-option-handle",update:_.throttle(function(){l(p(this).closest(".ps-js-field").data("id"))},3e3)})}function l(e){var t=n.find(".ps-js-field").filter('[data-id="'+e+'"]'),i=t.find(".ps-js-options").children(".ps-js-fieldconf").find("input[type=text]"),o=t.find(".ps-js-options").siblings(".ps-js-loading"),s={};s.id=e,s.prop="select_options",s.value={},s.json=1,i.each(function(){var e=p(this);s.value[e.data("prop-key")]=e.val()}),s.value=JSON.stringify(s.value),o.stop().show(),a[e]&&a[e].ret&&a[e].ret.abort(),a[e]=peepso.postJson("adminConfigFields.set_meta",s,function(e){o.stop().fadeOut()})}}(jQuery);