!function(e,t){var a,p,i="PsAvatar",s=(a=i,p=e.jQuery,peepso.createClass(a,peepso.npm.EventEmitter,{__constructor:function(e){this._useGravatar=!1,this._isTemp=!1,this.$file=this._uploadInit(e)},uploadUrl:peepsodata.ajaxurl_legacy+"profile.upload_avatar?avatar",uploadParams:function(){return{user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce}},upload:function(){this.$file&&this.$file.click()},_uploadInit:function(e){var t,a;return(a=e?p(e):((t=p('<div class="ps-js-uploader-avatar" />').css({position:"absolute",left:0,top:-999})).html('<input type="file" name="filedata" accept="image/*" />'),t.appendTo(document.body),t.find("input"))).psFileupload({url:this.uploadUrl,formData:this.uploadParams(),replaceFileInput:!1,dataType:"json",add:p.proxy(function(e,t){var a=peepsodata.avatar,i=t.files[0];/(\.|\/)(gif|jpe?g|png)$/i.test(i.type)?parseInt(i.size)>a.uploadMaxSize?this.emit("uploadfail",a.textErrorFileSize):t.submit():this.emit("uploadfail",a.textErrorFileType)},this),submit:p.proxy(function(){this.emit("uploadsubmit")},this),done:p.proxy(function(e,t){var a,i,s=t.result;s.success?(a=s.data&&s.data.image_url,i=s.data&&s.data.orig_image_url,this._useGravatar=!1,this._isTemp=!0,this.emit("uploaddone",a,i)):this.emit("uploadfail",s.errors)},this)}),a},crop:function(e,a,i,s,r,o){return p.Deferred(p.proxy(function(t){peepso.postJson("profile.crop",{user_id:peepsodata.userid,x:e,y:a,x2:i,y2:s,width:r,height:o,tmp:this._isTemp?1:0,_wpnonce:peepsodata.avatar.uploadNonce},p.proxy(function(e){e&&e.success?t.resolveWith(this,[e.data&&e.data.image_url]):t.rejectWith(this)},this))},this))},remove:function(){return p.Deferred(p.proxy(function(t){peepso.postJson("profile.remove_avatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce},p.proxy(function(e){e&&e.success?t.resolveWith(this,[e.data&&e.data.image_url]):t.rejectWith(this)},this))},this))},useGravatar:function(){return p.Deferred(p.proxy(function(t){peepso.postJson("profile.use_gravatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,_wpnonce:peepsodata.avatar.uploadNonce},p.proxy(function(e){e&&e.success?(this._useGravatar=!0,t.resolveWith(this,[e.data&&e.data.image_url])):t.rejectWith(this)},this))},this))},finalize:function(){return p.Deferred(p.proxy(function(t){peepso.postJson("profile.confirm_avatar",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,use_gravatar:this._useGravatar?1:0,_wpnonce:peepsodata.avatar.uploadNonce},p.proxy(function(e){e&&e.success?t.resolveWith(this):t.rejectWith(this)},this))},this))}}));"object"==typeof module&&module.exports?module.exports=s:e[i]=s}(window);