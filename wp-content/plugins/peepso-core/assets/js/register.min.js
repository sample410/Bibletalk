!function(u){peepsodata.register&&peepsodata.register.confirm_email_field;function s(e){var t,i,r,a,n,s,o,p=u(e),d=p.find("input[type=text],input[type=email],input[type=password],input[type=checkbox],input[type=radio],textarea,select");if(d.length)return t=d.eq(0).data("id"),i=d.eq(0).attr("name")||"",a="checkbox"===(r=(d.eq(0).attr("type")||"").toLowerCase())?(a=d.filter(":checked").map(function(){return this.value}),a=u.makeArray(a),JSON.stringify(a)):"radio"===r?d.filter(":checked").val():d.hasClass("datepicker")?d.data("value"):peepso.observer.applyFilters("profile_field_save",d.val(),d),0<=["username","email","email_verify","password","password2","terms","privacy","g-recaptcha-response"].indexOf(i)?(n=!0,s=peepsodata.ajaxurl_legacy+"profilefieldsajax.validate_register",(o={}).name=i,o[i]=a,"email_verify"===i?(d=d.closest("form.ps-js-form-register").find("[name=email]"),o.email=d.val()):"password2"===i&&(d=d.closest("form.ps-js-form-register").find("[name=password]"),o.password=d.val())):(n=!1,s=peepsodata.ajaxurl_legacy+"profilefieldsajax.validate",o={user_id:peepsodata.currentuserid,view_user_id:peepsodata.userid,id:t,value:a}),u.Deferred(function(r){u.ajax({url:s,type:"post",dataType:"json",data:o}).always(function(e){var t,i=p.find(".ps-form__error");e.responseJSON&&(e=e.responseJSON),e.errors&&e.errors.length?(i.empty(),t=n?e.errors:e.errors[0],_.each(t,function(e){i.append("<li>"+e+"</li>")}),i.show()):i.hide(),r.resolve.apply(null,arguments)})})}var e=u(document).find("form.ps-js-form-register");e.on("input","input[type=text]:not(.ps-js-field-location),input[type=email],input[type=password],textarea",_.debounce(function(e){s(u(e.target).closest(".ps-form__field"))},500)).on("click","input[type=checkbox],input[type=radio]",_.debounce(function(e){s(u(e.target).closest(".ps-form__field"))},100)).on("change","select",_.debounce(function(e){s(u(e.target).closest(".ps-form__field"))},100)).on("submit.ps-register",function(e){return e.preventDefault(),e.stopPropagation(),function(e){var t=u(e),i=t.find(".ps-form__field"),r=i.find("input.datepicker"),a=t.find("button[type=submit]"),n=[];errors=[],t.data("ps-submitting")||(t.data("ps-submitting",!0),i.each(function(){var e=s(this);e&&n.push(e)}),a.find("img").show(),u.when.apply(u,n).done(function(){var e;for(e in a.find("img").hide(),arguments)if(arguments[e][0].errors)return void t.removeData("ps-submitting");r.length&&r.each(function(){var e=u(this),t=e.data("value");t&&($hidden=u('<input type="hidden" name="'+e.attr("name")+'" />'),e.removeAttr("name"),$hidden.insertAfter(e),$hidden.val(t))}),i.length&&i.each(function(){$input=u(this).find("input[type=text],input[type=email],input[type=password],input[type=checkbox],input[type=radio],textarea,select"),peepso.observer.doAction("profile_field_save_register",$input)}),t.off("submit.ps-register"),setTimeout(function(){a.click()},100)}))}(this),!1}),e.on("input","input[name=username]",function(){var e=this.value.replace(/[^a-z0-9-_\.@]/gi,"");this.value!==e&&(this.value=e)});var i=e.find("input[name=terms], input[name=privacy]"),r=e.find("[type=submit]");i.length&&i.on("click.ps-register-consent",function(e){var t=[];i.each(function(){t.push(!!this.checked)}),0<=t.indexOf(!1)?(e.stopPropagation(),r.attr("disabled","disabled")):r.removeAttr("disabled")}).triggerHandler("click.ps-register-consent"),u(function(){setTimeout(function(){e.find(".ps-js-location-wrapper .ps-btn").on("mousedown",_.debounce(function(e){s(u(e.target).closest(".ps-form__field"))},100))},1e3)})}(jQuery);