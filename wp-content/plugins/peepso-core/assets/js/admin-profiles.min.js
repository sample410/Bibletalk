!function(v){var s,e=v(".ps-js-fields-container");e.on("input",".ps-js-field input[type=text]",function(){v(this).closest(".ps-js-fieldconf").find(".ps-js-btn").show()}).on("keydown",".ps-js-field input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),v(this).closest(".ps-js-fieldconf").find(".ps-js-save").click())}).find(".ps-js-field input[type=text]").each(function(){v(this).data("original-value",this.value)}),e.on("click",".ps-js-field .ps-js-cancel",function(){var e=v(this).closest(".ps-js-fieldconf"),t=e.find(".ps-js-btn"),s=e.find("input[type=text]");t.hide(),s.val(s.data("original-value"))}),e.on("click",".ps-js-field .ps-js-save",function(){var e,t,s=v(this).closest(".ps-js-fieldconf"),a=s.find(".ps-js-btn"),i=s.find("input[type=text]"),o=s.find(".ps-js-progress");if(e="adminConfigFields.set_"+("meta"===i.data("prop-type")?"meta":"prop"),"validation"===(t={id:i.data("parent-id")||void 0,prop:i.data("prop-name")||void 0,key:i.data("prop-key")||void 0,value:i.val()}).prop){var n,d,l,p,r=t.key.match(/^[a-z]+(min|max)_value$/),c=!1;if(r&&(""===v.trim(t.value)||isNaN(t.value)||+t.value<0?c=peepsoadminprofilesdata.number_invalid:(l=t.key.replace(r[1],"min"===r[1]?"max":"min"),d=(n=s.closest(".ps-tab__content")).find('[data-prop-key="'+l+'"]'),n.find('[data-prop-key="'+l.replace("_value","")+'"]')[0].checked&&(p=d.data("original-value")||d.val(),"min"===r[1]&&+p<+t.value?c=(c=peepsoadminprofilesdata.min_invalid).replace(/%d/g,+p):"max"===r[1]&&+p>+t.value&&(c=(c=peepsoadminprofilesdata.max_invalid).replace(/%d/g,+p))))),c)return void alert(c)}o.find("img").show(),i.attr("readonly","readonly"),peepso.postJson(e,t,function(e){o.find("img").hide(),o.find("i").show().delay(800).fadeOut(),i.removeAttr("readonly"),e.success&&(a.hide(),i.data("original-value",t.value),"post_title"==i.data("prop-name")&&v("#field-"+t.id+"-box-title").html(t.value))})}),e.on("click","input[type=checkbox]",_.throttle(function(){var e,s,a=v(this),i=a.closest(".ps-js-fieldconf").find(".ps-js-progress"),o=a[0].checked,n=!1;if(e="adminConfigFields.set_"+("meta"===a.data("prop-type")?"meta":"prop"),s={id:a.data("parent-id")||void 0,prop:a.data("prop-name")||void 0,key:a.data("prop-key")||void 0,value:o?a.val():a.data("disabled-value")},o&&"validation"===s.prop){var t,d,l,p,r,c,f,u=s.key.match(/^[a-z]+(min|max)$/);u&&(c=s.key.replace(u[1],"min"===u[1]?"max":"min"),p=(t=a.closest(".ps-tab__content")).find('[data-prop-key="'+c+'"]'),r=t.find('[data-prop-key="'+c+'_value"]'),p[0].checked&&(f=r.data("original-value")||r.val(),"min"===u[1]&&+f<+s.value?n=!0:"max"===u[1]&&+f>+s.value&&(n=!0)),n&&(d=t.find('[data-prop-key="'+s.key+'_value"]'),l=d.nextAll(".ps-js-save"),d.val(f)))}i.find("i").stop().hide(),i.find("img").show(),a.attr("readonly","readonly"),peepso.postJson(e,s,function(e){if(i.find("img").hide(),i.find("i").show().delay(800).fadeOut(),a.removeAttr("readonly"),e.success)if(n&&l.trigger("click"),$value_container_id="#"+a[0].id+"-value-container",$container_id="#"+a[0].id+"-container",o?v($value_container_id).fadeIn(500):v($value_container_id).fadeOut(500),"validation"===s.prop&&"required"===s.key){var t=v("#field-"+s.id+"-required-mark");o?t.removeClass("hidden"):t.addClass("hidden")}else"post_status"===s.prop&&(o?a.closest(".postbox").removeClass("postbox-muted"):a.closest(".postbox").addClass("postbox-muted"))})},1e3)),e.on("change","select",_.throttle(function(){var e,t,s=v(this),a=s.closest(".ps-js-fieldconf").find(".ps-js-progress");e="adminConfigFields.set_"+("meta"===s.data("prop-type")?"meta":"prop"),t={id:s.data("parent-id")||void 0,prop:s.data("prop-name")||void 0,key:s.data("prop-key")||void 0,value:s.val()},a.find("i").stop().hide(),a.find("img").show(),s.attr("readonly","readonly"),peepso.postJson(e,t,function(e){a.find("img").hide(),a.find("i").show().delay(800).fadeOut(),s.removeAttr("readonly"),e.success})},1e3)),e.sortable({handle:".ps-js-handle",update:_.throttle(function(){var e=[];v(".ps-js-fields-container .postbox").each(function(){e.push(v(this).data("id"))}),peepso.postJson("adminConfigFields.set_order",{fields:JSON.stringify(e)},function(e){})},3e3)}),e.on("click",".ps-js-field-toggle",function(){var e=v(this),t=e.closest(".postbox"),s=t.find(".ps-js-field"),a=t.data("id");s.is(":visible")?s.slideUp("fast",function(){e.removeClass("fa-compress").addClass("fa-expand"),i(),o(a,0)}):s.slideDown("fast",function(){e.removeClass("fa-expand").addClass("fa-compress"),i(),o(a,1)})}),e.on("click",".ps-js-field-title",function(e){e.target===e.currentTarget&&v(this).closest(".ps-postbox__title").find(".ps-js-field-toggle").click()}),e.on("mousedown",".ps-postbox__title",function(e){var t=v(e.currentTarget);s=setTimeout(function(){t.addClass("ps-js-mousedown")},200)}).on("mouseup mouseleave",".ps-postbox__title",function(e){clearTimeout(s),v(e.currentTarget).removeClass("ps-js-mousedown")}),v(".ps-js-field-expand-all").on("click",function(){e.find(".ps-js-field").slideDown("fast",function(){t(1)})}),v(".ps-js-field-collapse-all").on("click",function(){e.find(".ps-js-field").slideUp("fast",function(){t(0)})});var t=_.debounce(function(e){var t=v(".ps-js-fields-container").children(".postbox");0===e?t.find(".ps-js-field-toggle").removeClass("fa-compress").addClass("fa-expand"):t.find(".ps-js-field-toggle").removeClass("fa-expand").addClass("fa-compress"),i(e),o("all",e)},200);function i(e){var t,s,a=v(".ps-js-field-toggle-all"),i=a.find("span").first(),o=a.find("span").last();void 0===e&&(e=s=t=0,v(".ps-js-fields-container").find(".ps-js-field").each(function(){t++,v(this).is(":visible")&&s++}),t<=s&&(e=1)),0==+e?(a.data("status",0),o.html(a.data("expand-text")),i.removeClass("fa-compress").addClass("fa-expand")):(a.data("status",1),o.html(a.data("collapse-text")),i.removeClass("fa-expand").addClass("fa-compress"))}i();var a={},o=_.debounce(function(e,t){var s=[];"all"!==e?s=[e]:v(".ps-js-fields-container").children(".postbox").each(function(){s.push(v(this).data("id"))}),a[e]&&a[e].ret&&a[e].ret.abort(),a[e]=peepso.postJson("adminConfigFields.set_admin_box_status",{id:JSON.stringify(s),status:t},function(e){})},500);v(".ps-js-field-new").on("click",function(){var e="no-plugin-warning",t=v("#"+e);if(!t.length){var s=window.peepsoadminprofilesdata||{};(t=v(s.popup_template)).prop("id",e),t.appendTo(document.body),t.on("click",".button-link",function(){t.hide()}),t.on("click",".button-primary",function(e){e.preventDefault(),e.stopPropagation(),t.hide(),window.open(s.plugin_url)})}t.show()}),e.on("click",".ps-tabs a",function(){var e=v(this),t=e.closest(".ps-tabs").find(".active");return t.removeClass("active"),e.addClass("active"),v(t.attr("href")).hide(),v(e.attr("href")).show(),!1}),e.on("click",".ps-postbox__title .fa-edit",function(){var e=v(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),s=e.find(".ps-postbox__title-editor"),a=s.find("input[type=text]"),i=(a.nextAll(".ps-js-save"),a.data("prop-title-is-default")),o=a.val();t.hide(),s.show(),a.data("original-value",o).focus(),a.val(i?"":o).trigger("input")}),e.on("click",".ps-js-field-title-text",function(){v(this).closest(".ps-postbox__title").find(".fa-edit").click()}),e.on("click",".ps-postbox__title .ps-js-cancel",function(){var e=v(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),s=e.find(".ps-postbox__title-editor"),a=s.find("input[type=text]");a.val(a.data("original-value")),s.hide(),t.show()}),e.on("click",".ps-postbox__title .ps-js-save",function(){var e,t,s=v(this).closest(".ps-postbox__title"),a=s.find(".ps-postbox__title-label"),i=s.find(".ps-postbox__title-editor"),o=i.find("input[type=text]"),n=s.find(".ps-js-progress");e="adminConfigFields.set_"+("meta"===o.data("prop-type")?"meta":"prop"),t={id:o.data("parent-id")||void 0,prop:o.data("prop-name")||void 0,key:o.data("prop-key")||void 0,value:o.val()},n.find("img").show(),o.attr("readonly","readonly"),peepso.postJson(e,t,function(e){n.find("img").hide(),n.find("i").show().delay(800).fadeOut(),o.removeAttr("readonly"),e.success&&(i.hide(),a.show(),o.data("original-value",t.value),o.data("prop-title-is-default",!1),v("#field-"+t.id+"-box-title").html(t.value))})}),e.on("keydown",".ps-postbox__title input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),v(this).nextAll(".ps-js-save").click())}).on("input",".ps-postbox__title input[type=text]",function(e){var t=v(this).nextAll(".ps-js-save");v.trim(this.value)?t.removeAttr("disabled"):t.attr("disabled","disabled")}),e.on("focus",".ps-js-focusguard",function(){var e=v(this),t=e.closest(".ps-js-options").children(".ps-js-fieldconf");"last"===e.data("tag")?t.find("input").first().focus():t.find("input").last().focus()}),e.on("change","select[data-prop-name=date_range_min]",function(e){var t=v(this),s=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_max]");+s.val()<+t.val()&&s.val(t.val()).trigger("change")}),e.on("change","select[data-prop-name=date_range_max]",function(e){var t=v(this),s=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_min]");+s.val()>+t.val()&&s.val(t.val()).trigger("change")}),v(function(){v(".ps-settings__bar").addClass("ps-settings__bar--static"),v(window).scroll(function(){var e=v(".ps-settings__bar");50<v(this).scrollTop()?e.removeClass("ps-settings__bar--static"):e.addClass("ps-settings__bar--static")})})}(jQuery);