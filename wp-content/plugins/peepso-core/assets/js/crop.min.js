!function(p,t){var h,e,o,r=!/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent),i=(h=p,e=t,o=r,s.prototype.attach=function(){this.$elem.wrap(this.$wrapper),this.$cropper.insertAfter(this.$elem),this.$wrapper=this.$elem.parent(),this.hammertime||(this.hammertime=new e.Manager(this.$cropper[0]),this.hammertime.add(new e.Pan({direction:e.DIRECTION_ALL,treshhold:0})),this.hammertime.on("pan panstart panend",h.proxy(function(t){t.srcEvent.stopPropagation(),t.srcEvent.preventDefault(),"panstart"===t.type?(this.disableDesktopEvents(),this.onTouch(t)):"pan"===t.type?this.onDragOrResize(t):(this.onRelease(t),this.enableDesktopEvents())},this))),this.enableDesktopEvents()},s.prototype.detach=function(){this.$cropper.detach(),this.$elem.parent().is(this.$wrapper)&&this.$elem.unwrap()},s.prototype.measure=function(){var t=this.$elem,e=this.$wrapper[0],r=this.$cropper.position();return{imageWidth:t.width(),imageHeight:t.height(),wrapperTop:e.scrollTop,wrapperLeft:e.scrollLeft,wrapperWidth:this.$wrapper.width(),wrapperHeight:this.$wrapper.height(),cropperTop:r.top+e.scrollTop,cropperLeft:r.left+e.scrollLeft,cropperWidth:this.$cropper.outerWidth(),cropperHeight:this.$cropper.outerHeight()}},s.prototype.getPointerPosition=function(t,e){var r=this.$cropper.offset();return{top:e-r.top+this.$wnd.scrollTop(),left:t-r.left+this.$wnd.scrollLeft()}},s.prototype.getResizeDirection=function(t){var e=o?15:20,r=this.getPointerPosition(t.center.x,t.center.y),p=this.measurements,i="";return r.top<e?i+="n":r.top>p.cropperHeight-e&&(i+="s"),r.left<e?i+="w":r.left>p.cropperWidth-e&&(i+="e"),i},s.prototype.getSelection=function(){return{x:this.measurements.cropperLeft,y:this.measurements.cropperTop,width:this.measurements.cropperWidth,height:this.measurements.cropperHeight}},s.prototype.onTouch=function(t){this.released=!1,this.measurements=this.measure(),this.direction=this.getResizeDirection(t)},s.prototype.onDragOrResize=_.throttle(function(t){this.direction?this.onResize(t):this.onDrag(t)},o?10:100),s.prototype.onDrag=function(t){var e,r=this.measurements,p=t.deltaY,i=t.deltaX;this.released||(i=Math.min(i,r.imageWidth-r.cropperWidth-r.cropperLeft),i=Math.max(i,0-r.cropperLeft),p=Math.min(p,r.imageHeight-r.cropperHeight-r.cropperTop),e="translate3d("+i+"px, "+(p=Math.max(p,0-r.cropperTop))+"px, 0)",this.$cropper.css({webkitTransform:e,mozTransform:e,transform:e}))},s.prototype.onResize=function(t){var e=this.direction,r=this.measurements,p={};this.released||(e.match(/n/)?(p.top="auto",p.bottom=r.wrapperHeight-r.cropperTop-r.cropperHeight,p.height=r.cropperHeight-t.deltaY):e.match(/s/)&&(p.bottom="auto",p.top=r.cropperTop,p.height=r.cropperHeight+t.deltaY),e.match(/e/)?(p.right="auto",p.left=r.cropperLeft,p.width=r.cropperWidth+t.deltaX):e.match(/w/)&&(p.left="auto",p.right=r.wrapperWidth-r.cropperLeft-r.cropperWidth,p.width=r.cropperWidth-t.deltaX),p.width=p.height=Math.max(p.width||0,p.height||0,64),e.match(/n/)?p.height=Math.min(p.height,r.wrapperHeight-p.bottom):e.match(/s/)?p.height=Math.min(p.height,r.imageHeight-p.top):"auto"!==this.$cropper[0].style.top?p.height=Math.min(p.height,r.imageHeight-parseInt(this.$cropper.css("top"))):p.height=Math.min(p.height,r.wrapperHeight-parseInt(this.$cropper.css("bottom"))),e.match(/e/)?p.width=Math.min(p.width,r.imageWidth-p.left):e.match(/w/)?p.width=Math.min(p.width,r.wrapperWidth-p.right):"auto"!==this.$cropper[0].style.left?p.width=Math.min(p.width,r.imageWidth-parseInt(this.$cropper.css("left"))):p.width=Math.min(p.width,r.wrapperWidth-parseInt(this.$cropper.css("right"))),p.width=p.height=Math.min(p.width,p.height),this.$cropper.css(p))},s.prototype.onRelease=function(t){var e=this.$cropper.position(),r=this.measurements,p={top:Math.max(e.top+r.wrapperTop,0),left:Math.max(e.left+r.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""};this.released=!0,this.$cropper.css(p),this.measurements=this.measure(),this.change(this.getSelection())},s.prototype.destroy=function(){this.detach(),this.$elem=null,this.$wrapper=null,this.$cropper=null,this.$wnd=null,this.hammertime=null},s.prototype.enableDesktopEvents=function(){o&&this.$cropper.on("mousemove.ps-crop",h.proxy(this.onMouseMove,this))},s.prototype.disableDesktopEvents=function(){o&&this.$cropper.off("mousemove.ps-crop")},s.prototype.onMouseMove=function(t){var e=h(t.target).parent().offset(),r=t.pageX-e.left,p=t.pageY-e.top,i="",o=this.measure();p<o.cropperTop-o.wrapperTop+15?i+="n":p>o.cropperTop-o.wrapperTop+o.cropperHeight-15&&(i+="s"),r<o.cropperLeft-o.wrapperLeft+15?i+="w":r>o.cropperLeft-o.wrapperLeft+o.cropperWidth-15&&(i+="e"),this.$cropper.css({cursor:i?i+"-resize":""})},s);function s(t){this.$elem=h(t.elem),this.$wrapper=h('<div class="ps-crop-wrapper" />'),this.$cropper=h('<div class="ps-crop-box" />'),this.$wnd=h(window),this.change=t.change||h.noop,this.attach(),this.measurements=this.measure(),this.change(this.getSelection())}ps_crop={init:function(t){var e=p(t.elem),r=e.data("ps-crop");r&&r.destroy(),r=new i(t),e.data("ps-crop",r)},detach:function(t){var e;(e=(t=p(t)).data("ps-crop"))&&e.detach()}}}(jQuery||$,Hammer,peepso);